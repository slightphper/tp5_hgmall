<!DOCTYPE html>
<html><head>
	<meta charset="utf-8">
    <title>嗨购驿站--后台管理系统</title>

    <meta name="description" content="Dashboard">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--Basic Styles-->
    <link href="__admin__/style/bootstrap.css" rel="stylesheet">
    <link href="__admin__/style/font-awesome.css" rel="stylesheet">
    <link href="__admin__/style/weather-icons.css" rel="stylesheet">

    <!--Beyond styles-->
    <link id="beyond-link" href="__admin__/style/beyond.css" rel="stylesheet" type="text/css">
    <link href="__admin__/style/demo.css" rel="stylesheet">
    <link href="__admin__/style/typicons.css" rel="stylesheet">
    <link href="__admin__/style/animate.css" rel="stylesheet">
    <style type="text/css">
    .price{
        width: 150px;
        margin-left: 10px;
        display: inline-block;
    }
    .abtn{
        padding-right: 10px;
    }
    </style>
    
</head>
<body>
	<!-- 头部 -->
    {include file="common/top"}
	<!-- /头部 -->
	
	<div class="main-container container-fluid">
		<div class="page-container">
			<!-- Page Sidebar -->
            {include file="common/left"}
            <!-- /Page Sidebar -->
            <!-- Page Content -->
            <div class="page-content">
                <!-- Page Breadcrumb -->
                <div class="page-breadcrumbs">
                    <ul class="breadcrumb">
                         <li>
                            <a href="{:url('Index/index')}">系统</a>
                         </li>
                         <li>
                            <a href="{:url('Goods/lst')}">商品列表</a>
                        </li>
                        <li class="active">添加商品</li>
                    </ul>
                </div>
                <!-- /Page Breadcrumb -->

                <!-- Page Body -->
                <div class="page-body">
                    
<div class="row">
    <div class="col-lg-12 col-sm-12 col-xs-12">
        <div class="widget">
            <form class="form-horizontal" role="form" action="{:url('Goods/add')}" method="post" enctype="multipart/form-data">
            <!-- 商品信息开始 -->
            <div class="widget-body">
                <div class="widget-main ">
                    <div class="tabbable">
                        <ul id="myTab11" class="nav nav-tabs tabs-flat">
                            <li class="active">
                                <a href="#baseinfo" data-toggle="tab">
                                    基本信息
                                </a>
                            </li>
                            <li class="">
                                <a href="#goodsdes" data-toggle="tab">
                                    商品简介
                                </a>
                            </li>
                           <li class="">
                                <a href="#mbprice" data-toggle="tab">
                                   会员价格
                                </a>
                            </li>
                            <li class="">
                                <a href="#goodsattr" data-toggle="tab">
                                    商品属性
                                </a>
                            </li>
                             <li class="">
                                <a href="#goodsphoto" data-toggle="tab">
                                    商品相册
                                </a>
                            </li> 
                        </ul>
                        <div class="tab-content tabs-flat">
                            <!-- 基本信息 -->
                            <div class="tab-pane active" id="baseinfo">
                                <div class="form-group">
                                <label for="username" class="col-sm-2 control-label no-padding-right">商品名称</label>
                                <div class="col-sm-6">
                                    <input class="form-control"  placeholder="请输入商品名称" name="goods_name" required="" type="text">
                                </div>
                                <p class="help-block col-sm-4 red">* 必填</p>
                                </div>

                                <div class="form-group">
                                <label for="username" class="col-sm-2 control-label no-padding-right">商品主图</label>
                                <div class="col-sm-6">
                                    <input class="form-control" type="file" name="og_thumb" style="border:none; box-shadow:none;width:50%">
                                </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">所属分类</label>
                                    <div class="col-sm-6">
                                        <select name="category_id" id="category_id">
                                            <option value="">请选择</option>
                                             {volist name="categoryRes" id="cate"}
                                            <option value="{$cate.id}">
                                            <?php echo str_repeat('-',$cate['level']*2)?>{$cate.cate_name}
                                            </option>
                                            {/volist}
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">所属品牌</label>
                                    <div class="col-sm-6">
                                        <select name="brand_id" >
                                            <option value="">请选择</option>
                                            {volist name="brandRes" id="brand"}
                                            <option value="{$brand.id}">
                                               {$brand.brand_name}
                                            </option>
                                            {/volist}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">市场价</label>
                                    <div class="col-sm-6">
                                        <input class="form-control"  placeholder="" name="markte_price" required="" type="text">
                                    </div>
                                    <p class="help-block col-sm-4 red">* 必填</p>
                                </div>

                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">在售价</label>
                                    <div class="col-sm-6">
                                        <input class="form-control"  placeholder="" name="shop_price" required="" type="text">
                                    </div>
                                    <p class="help-block col-sm-4 red">* 必填</p>
                                </div>

                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">推荐位展示</label>
                                    <div class="col-lg-4 col-sm-4 col-xs-4">
                                        <div class="checkbox">
                                            {volist name="goodsRecRes" id="recRes"}
                                            <label style="padding-right:10px;">
                                                <input type="checkbox" name="rec_pos[]" value="{$recRes.id}">
                                                <span class="text">{$recRes.rec_name}</span>
                                            </label>
                                            {/volist}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                        <label for="username" class="col-sm-2 control-label no-padding-right">是否上架</label>
                                        <div class="col-sm-6">
                                          <div class="radio" style="float:left; padding-right:10px;">
                                            <label>
                                                <input name="on_sale" value="1" class="colored-blue"  type="radio" checked="checked">
                                                <span class="text">是 </span>
                                            </label>
                                        </div>
                                        <div class="radio" style="float:left;">
                                            <label>
                                                <input name="on_sale" value="0" class="colored-blue" type="radio" >
                                                <span class="text">否 </span>
                                        </label>
                                        </div>
                                    </div>
                                 </div>

                            </div>
                            <!-- 商品描述 -->
                            <div class="tab-pane" id="goodsdes">
                                <textarea  id="goods_desc" name="goods_desc"></textarea>
                            </div>
                            <!-- 会员价格 -->
                           <div class="tab-pane" id="mbprice">
                                {volist name="mlRes" id="ml"}
                                <div class="form-group">
                                <label for="username" class="col-sm-2 control-label no-padding-right">{$ml.level_name}</label>
                                <div class="col-sm-6">
                                    <input class="form-control"  placeholder="请输入商品价格" name="mp[{$ml.id}]" type="text">
                                </div>
                                <p class="help-block col-sm-4 red">* 必填</p>
                                </div>
                                {/volist}
                            </div>
                            <!-- 商品属性 -->
                              <div class="tab-pane" id="goodsattr">
                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">商品类型</label>
                                    <div class="col-sm-6">
                                        <select name="type_id">
                                            <option value="">请选择</option>
                                            {volist name="typeRes" id="type"}
                                            <option value="{$type.id}">{$type.type_name}</option>
                                            {/volist}
                                        </select>
                                    </div>
                                </div>
                                <div id="attr_list">
                                  <!-- 属性显示js实现 -->
                                </div>
                            </div> 
                            <!-- 商品相册 -->
                            <div class="tab-pane" id="goodsphoto">
                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right">商品相册</label>
                                    <div class="col-sm-6"></div>
                                </div>
                                <div class="form-group">
                                    <label for="username" class="col-sm-2 control-label no-padding-right"></label>
                                    <div class="col-sm-6">
                                       <a href="#" onclick="addrow(this)">[+]</a><input class="form-control" style="border:none; box-shadow:none; width:30%; display:inline-block;"  type="file" name="goods_photo[]">
                                    </div>
                                </div>
                                <div id="goods_photo"></div>

                            </div> 

                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button id="formbtn" type="submit" class="btn btn-default">保存信息</button>
                        </div>
                    </div>
                        </div>
                     </div>
                    <!-- 商品信息结束 -->
             </form>
        </div>
    </div>
</div>

                </div>
                <!-- /Page Body -->
            </div>
            <!-- /Page Content -->
		</div>	
	</div>

	    <!--Basic Scripts-->
    <script src="__admin__/style/jquery_002.js"></script>
    <script src="__admin__/style/bootstrap.js"></script>
    <script src="__admin__/style/jquery.js"></script>
    <!--Beyond Scripts-->
    <script src="__admin__/style/beyond.js"></script>
    <!-- 引入ueditor -->
    <script src="__plus__/ueditor/ueditor.config.js"></script>
    <script src="__plus__/ueditor/ueditor.all.min.js"></script>
    <script src="__plus__/ueditor/lang/zh-ch/zh-cn.js"></script>
    <script type="text/javascript">
    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    UE.getEditor('goods_desc',{initialFrameWidth:1000,initialFrameHeight:400,toolbars: [['fullscreen', 'source', 'undo', 'redo','bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript','removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist','selectall', 'cleardoc']]});   
   </script>
   <script type="text/javascript">
    $("select[name=type_id]").change(function(){
        var type_id = $(this).val();
        $.ajax({
            type :"POST",
            url :"{:url('Attr/ajaxGetAttr')}",
            data: {type_id:type_id},
            dataType:"json",
            success:function(data){
                var html="";  
                $(data).each(function(k,v){
                    if(v.attr_type == 1){
                        //单选
                        html+= "<div class='form-group'>";
                        html+= "<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
                        var attrValuesArr = v.attr_values.split(',');
                        html+= "<div class='col-sm-6'><a class='abtn' onclick='addrow(this)' href='#'>[+]</a>";
                        html+= "<select name='goods_attr["+v.id+"][]'>";
                        html+= "<option value=''>请选择</option>";
                        for(var i=0; i<attrValuesArr.length;i++){
                            html+= "<option value='"+attrValuesArr[i]+"'>"+attrValuesArr[i]+"</option>";
                        }
                        html+= "</select>";
                        html+= "<input class='form-control price' placeholder='价格' name='attr_price[]' type='text'>";
                        html+= "</div></div>";
                    }else{
                        //唯一
                        if(v.attr_values){
                            html+= "<div class='form-group'>";
                            html+= "<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name +"</label>";
                            var attrValuesArr = v.attr_values.split(',');
                            html+= "<div class='col-sm-6'>";
                            html+= "<select name='goods_attr["+v.id+"]' style='margin-left:27px'>";
                            html+= "<option value=''>请选择</option>";
                            for(var i=0; i<attrValuesArr.length;i++){
                                html+= "<option value='"+attrValuesArr[i]+"'>"+attrValuesArr[i]+"</option>";
                            }
                            html+= "</select>";
                            html+= "</div></div>";
                        }else{
                            html+= "<div class='form-group'>";
                            html+= "<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
                            var attrValuesArr = v.attr_values.split(',');
                            html+= "<div class='col-sm-6'>";
                            html+= "<input class='form-control price' name='goods_attr["+v.id+"]' type='text' style='margin-left:27px'>";
                            html+= "</div></div>";
                        }
                    }
                });
                $("#attr_list").html(html);
            }
        });
    });
    //点击 添加/删除 兄弟节点
    function addrow(o){
        var div = $(o).parent().parent();
        if($(o).html() == '[+]'){
            var newdiv = div.clone();
            newdiv.find('a').html('[-]');
            div.after(newdiv);
        }else{
            div.remove();
        }
    }

    //验证商品分类不能为空

   </script>

</body></html>